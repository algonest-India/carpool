<%
// Helper function for date formatting
const formatDate = (timestamp) => {
  const date = new Date(timestamp);
  return date.toLocaleDateString('en-US', { 
    month: 'short', 
    day: 'numeric', 
    year: 'numeric' 
  });
};

const formatTime = (timestamp) => {
  const date = new Date(timestamp);
  return date.toLocaleTimeString('en-US', { 
    hour: '2-digit', 
    minute: '2-digit' 
  });
};

const truncateText = (text, maxLength = 30) => {
  return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
};
%>

<!-- Hero Section -->
<section class="hero-section" aria-labelledby="hero-title">
  <div class="container-fluid">
    <div class="row align-items-center min-vh-100">
      <div class="col-12 col-lg-6">
        <div class="hero-content">
          <h1 id="hero-title" class="hero-title">
            <span class="text-primary">Share</span> <span class="text-white">Your Journey,</span><br>
            <span class="text-accent">Save</span> <span class="text-white">Our Planet</span>
          </h1>
          <p class="hero-subtitle">
            Join thousands of smart travelers who are saving money, reducing their carbon footprint, and building communities through carpooling.
          </p>
          <div class="hero-stats d-flex flex-wrap gap-4 mb-4">
            <div class="stat-item">
              <span class="stat-number">10K+</span>
              <span class="stat-label">Active Users</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">50K+</span>
              <span class="stat-label">Trips Completed</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">2M+</span>
              <span class="stat-label">CO₂ Saved (kg)</span>
            </div>
          </div>
          <div class="hero-actions d-flex flex-column flex-sm-row gap-3">
            <% if (!user) { %>
              <a href="/auth/register" class="btn btn-primary btn-lg px-4 py-3">
                <i class="fas fa-rocket me-2"></i>Start Your Journey
              </a>
              <a href="/trips" class="btn btn-outline-light btn-lg px-4 py-3">
                <i class="fas fa-search me-2"></i>Explore Trips
              </a>
            <% } else { %>
              <a href="/trips/create" class="btn btn-primary btn-lg px-4 py-3">
                <i class="fas fa-plus me-2"></i>Create Trip
              </a>
              <a href="/trips" class="btn btn-outline-light btn-lg px-4 py-3">
                <i class="fas fa-search me-2"></i>Find Trips
              </a>
            <% } %>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="hero-visual">
          <div class="floating-cars">
            <div class="car car-1">
              <i class="fas fa-car"></i>
            </div>
            <div class="car car-2">
              <i class="fas fa-car-side"></i>
            </div>
            <div class="car car-3">
              <i class="fas fa-shuttle-van"></i>
            </div>
          </div>
          <div class="hero-image">
            <div class="image-placeholder">
              <i class="fas fa-route"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- User Dashboard Section -->
<% if (user && userStats) { %>
<section class="dashboard-section py-5" aria-labelledby="dashboard-title">
  <div class="container">
    <div class="row mb-4">
      <div class="col-12">
        <h2 id="dashboard-title" class="section-title text-center">
          <i class="fas fa-tachometer-alt me-2 text-primary"></i>Your Dashboard
        </h2>
      </div>
    </div>
    <div class="row g-4">
      <div class="col-12 col-md-6 col-lg-3">
        <div class="dashboard-card">
          <div class="card-icon bg-primary">
            <i class="fas fa-calendar-check"></i>
          </div>
          <div class="card-content">
            <div class="card-number"><%= userStats.upcomingTrips || 0 %></div>
            <div class="card-label">Upcoming Trips</div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="dashboard-card">
          <div class="card-icon bg-success">
            <i class="fas fa-ticket-alt"></i>
          </div>
          <div class="card-content">
            <div class="card-number"><%= userStats.recentBookings || 0 %></div>
            <div class="card-label">Recent Bookings</div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="dashboard-card">
          <div class="card-icon bg-info">
            <i class="fas fa-leaf"></i>
          </div>
          <div class="card-content">
            <div class="card-number"><%= (userStats.recentBookings || 0) * 25 %></div>
            <div class="card-label">CO₂ Saved (lbs)</div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="dashboard-card">
          <div class="card-icon bg-warning">
            <i class="fas fa-star"></i>
          </div>
          <div class="card-content">
            <div class="card-number">4.8</div>
            <div class="card-label">Your Rating</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<% } %>

<!-- Featured Trips Section -->
<section class="trips-section py-5" aria-labelledby="trips-title">
  <div class="container">
    <div class="row align-items-center mb-4">
      <div class="col-12 col-md-8">
        <h2 id="trips-title" class="section-title">
          <i class="fas fa-road me-2 text-primary"></i>Available Trips
        </h2>
        <p class="section-subtitle">Find your perfect ride and connect with fellow travelers</p>
      </div>
      <% if (trips && trips.length > 0) { %>
        <div class="col-12 col-md-4 text-md-end">
          <a href="/trips" class="btn btn-outline-primary">
            <i class="fas fa-list me-2"></i>View All Trips
          </a>
        </div>
      <% } %>
    </div>

    <!-- Error Message -->
    <% if (error) { %>
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Error:</strong> <%= error %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        </div>
      </div>
    <% } %>

    <!-- No Trips State -->
    <% if (!trips || trips.length === 0) { %>
      <div class="empty-state text-center py-5">
        <div class="empty-icon">
          <i class="fas fa-car-side"></i>
        </div>
        <h3 class="empty-title">No Trips Available</h3>
        <p class="empty-description">
          Be the first to create a trip or check back soon for more options.
        </p>
        <div class="empty-actions d-flex flex-column flex-sm-row justify-content-center gap-3">
          <% if (!user) { %>
            <a href="/auth/register" class="btn btn-primary btn-lg">
              <i class="fas fa-user-plus me-2"></i>Register to Create Trips
            </a>
            <a href="/trips" class="btn btn-outline-primary btn-lg">
              <i class="fas fa-search me-2"></i>Browse Later
            </a>
          <% } else { %>
            <a href="/trips/create" class="btn btn-primary btn-lg">
              <i class="fas fa-plus me-2"></i>Create Your First Trip
            </a>
          <% } %>
        </div>
      </div>
    <% } else { %>
      <!-- Trips Grid -->
      <div class="row g-4">
        <% trips.forEach((trip, index) => { %>
          <div class="col-12 col-md-6 col-lg-4">
            <article class="trip-card h-100" data-trip-id="<%= trip.id %>">
              <!-- Trip Header -->
              <div class="trip-header">
                <div class="driver-info">
                  <div class="driver-avatar">
                    <i class="fas fa-user-circle"></i>
                  </div>
                  <div class="driver-details">
                    <div class="driver-name"><%= trip.profiles?.full_name || 'Driver' %></div>
                    <div class="driver-rating">
                      <i class="fas fa-star text-warning"></i>
                      <span>4.8</span>
                    </div>
                  </div>
                </div>
                <% if (trip.price) { %>
                  <div class="trip-price">
                    <span class="price-amount">₹<%= parseFloat(trip.price).toFixed(2) %></span>
                    <span class="price-label">per seat</span>
                  </div>
                <% } %>
              </div>

              <!-- Trip Body -->
              <div class="trip-body">
                <!-- Route -->
                <div class="trip-route">
                  <div class="route-point origin">
                    <div class="route-icon">
                      <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="route-info">
                      <div class="route-label">From</div>
                      <div class="route-text" title="<%= trip.origin_text %>">
                        <%= truncateText(trip.origin_text) %>
                      </div>
                    </div>
                  </div>
                  
                  <div class="route-connector">
                    <div class="route-line"></div>
                    <i class="fas fa-arrow-down"></i>
                  </div>
                  
                  <div class="route-point destination">
                    <div class="route-icon">
                      <i class="fas fa-flag-checkered"></i>
                    </div>
                    <div class="route-info">
                      <div class="route-label">To</div>
                      <div class="route-text" title="<%= trip.destination_text %>">
                        <%= truncateText(trip.destination_text) %>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Trip Details -->
                <div class="trip-details">
                  <div class="detail-row">
                    <div class="detail-item">
                      <i class="fas fa-clock text-primary"></i>
                      <div class="detail-info">
                        <div class="detail-label">Departure</div>
                        <div class="detail-value">
                          <%= formatDate(trip.departure_timestamp) %><br>
                          <%= formatTime(trip.departure_timestamp) %>
                        </div>
                      </div>
                    </div>
                    <div class="detail-item">
                      <i class="fas fa-users text-success"></i>
                      <div class="detail-info">
                        <div class="detail-label">Seats</div>
                        <div class="detail-value">
                          <%= trip.available_seats %> available
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Trip Footer -->
              <div class="trip-footer">
                <a href="/trips/<%= trip.id %>" class="btn btn-primary w-100">
                  <i class="fas fa-info-circle me-2"></i>View Details
                </a>
              </div>
            </article>
          </div>
        <% }); %>
      </div>
    <% } %>
  </div>
</section>

<!-- Features Section -->
<section class="features-section py-5 bg-light" aria-labelledby="features-title">
  <div class="container">
    <div class="row mb-5">
      <div class="col-12 text-center">
        <h2 id="features-title" class="section-title">
          <i class="fas fa-star me-2 text-primary"></i>Why Choose Carpool Connect?
        </h2>
        <p class="section-subtitle">Experience the future of sustainable transportation</p>
      </div>
    </div>
    
    <div class="row g-4">
      <div class="col-12 col-md-4">
        <div class="feature-card h-100">
          <div class="feature-icon bg-primary">
            <i class="fas fa-piggy-bank"></i>
          </div>
          <h3 class="feature-title">Save Money</h3>
          <p class="feature-description">
            Split fuel costs and reduce travel expenses by sharing rides with fellow travelers. Save up to 60% on transportation costs.
          </p>
          <div class="feature-stats">
            <span class="stat">Save 60%</span>
            <span class="stat-label">on travel costs</span>
          </div>
        </div>
      </div>
      
      <div class="col-12 col-md-4">
        <div class="feature-card h-100">
          <div class="feature-icon bg-success">
            <i class="fas fa-leaf"></i>
          </div>
          <h3 class="feature-title">Eco-Friendly</h3>
          <p class="feature-description">
            Reduce carbon emissions and environmental impact. Every shared ride means fewer cars on the road and cleaner air for everyone.
          </p>
          <div class="feature-stats">
            <span class="stat">2M+ kg</span>
            <span class="stat-label">CO₂ saved</span>
          </div>
        </div>
      </div>
      
      <div class="col-12 col-md-4">
        <div class="feature-card h-100">
          <div class="feature-icon bg-info">
            <i class="fas fa-shield-alt"></i>
          </div>
          <h3 class="feature-title">Safe & Secure</h3>
          <p class="feature-description">
            Verified users, secure messaging, and comprehensive safety features ensure your peace of mind throughout your journey.
          </p>
          <div class="feature-stats">
            <span class="stat">100%</span>
            <span class="stat-label">verified users</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- How It Works Section -->
<section class="how-it-works-section py-5" aria-labelledby="how-it-works-title">
  <div class="container">
    <div class="row mb-5">
      <div class="col-12 text-center">
        <h2 id="how-it-works-title" class="section-title">
          <i class="fas fa-cogs me-2 text-primary"></i>How It Works
        </h2>
        <p class="section-subtitle">Get started in three simple steps</p>
      </div>
    </div>
    
    <div class="row g-4">
      <div class="col-12 col-md-4">
        <div class="step-card">
          <div class="step-number">1</div>
          <div class="step-icon">
            <i class="fas fa-search"></i>
          </div>
          <h3 class="step-title">Find a Trip</h3>
          <p class="step-description">
            Browse available trips or create your own. Search by route, date, and preferences.
          </p>
        </div>
      </div>
      
      <div class="col-12 col-md-4">
        <div class="step-card">
          <div class="step-number">2</div>
          <div class="step-icon">
            <i class="fas fa-handshake"></i>
          </div>
          <h3 class="step-title">Connect & Book</h3>
          <p class="step-description">
            Connect with drivers or passengers, verify details, and book your seat securely.
          </p>
        </div>
      </div>
      
      <div class="col-12 col-md-4">
        <div class="step-card">
          <div class="step-number">3</div>
          <div class="step-icon">
            <i class="fas fa-car"></i>
          </div>
          <h3 class="step-title">Share Your Journey</h3>
          <p class="step-description">
            Meet up, enjoy your shared ride, and rate your experience to help the community.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- CTA Section -->
<section class="cta-section py-5" aria-labelledby="cta-title">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-8 text-center">
        <h2 id="cta-title" class="cta-title">
          Ready to Start Your Carpool Journey?
        </h2>
        <p class="cta-subtitle">
          Join thousands of smart travelers who are saving money and helping the environment.
        </p>
        <div class="cta-actions d-flex flex-column flex-sm-row justify-content-center gap-3">
          <% if (!user) { %>
            <a href="/auth/register" class="btn btn-primary btn-lg px-5 py-3">
              <i class="fas fa-rocket me-2"></i>Get Started Now
            </a>
            <a href="/trips" class="btn btn-outline-primary btn-lg px-5 py-3">
              <i class="fas fa-search me-2"></i>Browse Trips
            </a>
          <% } else { %>
            <a href="/trips/create" class="btn btn-primary btn-lg px-5 py-3">
              <i class="fas fa-plus me-2"></i>Create a Trip
            </a>
            <a href="/trips" class="btn btn-outline-primary btn-lg px-5 py-3">
              <i class="fas fa-search me-2"></i>Find Trips
            </a>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</section>
