<%-
/**
 * Trips List Page - Carpool Connect
 * 
 * This EJS template renders the main trips listing page where users can browse
 * available carpool trips, filter results, and view detailed trip information.
 * 
 * Features:
 * - Enhanced header with call-to-action
 * - Advanced filtering and search
 * - Trip cards with driver information
 * - Responsive grid layout
 * - Pagination support
 * - User authentication state handling
 * 
 * Data Available:
 * - trips: Array of trip objects with driver profiles
 * - user: Current user object (if logged in)
 * - pagination: Pagination metadata
 * - filters: Current filter values
 * 
 * Author: Carpool Connect Team
 * Version: 1.0.0
 */
-%>

<!-- Enhanced Header Section -->
<!-- Load custom CSS for enhanced styling -->
<link rel="stylesheet" href="/css/trips-list-enhanced.css">

<div class="row mb-4">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-start">
      <!-- Main Title and Description -->
      <div class="flex-grow-1">
        <div class="mb-3">
          <h1 class="trips-list-title mb-2">
            <span class="badge bg-gradient-primary text-white me-2">ðŸš—</span> Find Your Perfect Ride
          </h1>
          <p class="trips-subtitle text-muted mb-0">Browse available carpool trips, save money, and reduce your carbon footprint</p>
        </div>
      </div>
      
      <!-- Create Trip Button (only shown to logged-in users) -->
      <% if (user) { %>
        <div class="header-actions">
          <a href="/trips/create" class="btn btn-primary btn-lg rounded-pill px-4">
            <i class="fas fa-plus me-2"></i>Create New Trip
          </a>
        </div>
      <% } %>
    </div>
  </div>
</div>

<!-- Enhanced Call to Action (shown only to non-logged-in users) -->
<!-- This encourages users to register to create trips -->
<% if (!user) { %>
  <div class="row mb-4">
    <div class="col-12">
      <div class="alert alert-info border-0 shadow-sm" role="alert">
        <div class="d-flex align-items-center">
          <div class="alert-icon me-3">
            <i class="fas fa-info-circle fa-lg"></i>
          </div>
          <div class="flex-grow-1">
            <strong>Want to create a trip?</strong> 
            <a href="/auth/register" class="alert-link fw-bold">Register an account</a> to start sharing rides and earning money.
          </div>
        </div>
      </div>
    </div>
  </div>
<% } %>

<!-- Enhanced Filters -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card shadow-lg border-0">
      <div class="card-header bg-gradient-info text-white">
        <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Filter Trips</h5>
      </div>
      <div class="card-body p-4">
        <form class="row g-3 align-items-end" method="GET" id="filterForm">
          <div class="col-md-3">
            <label for="search" class="form-label">Search Origin</label>
            <input type="text" class="form-control" id="search" placeholder="From..." name="search" value="<%= filters.origin || '' %>">
          </div>
          <div class="col-md-3">
            <label for="destination" class="form-label">Search Destination</label>
            <input type="text" class="form-control" id="destination" placeholder="To..." name="destination" value="<%= filters.destination || '' %>">
          </div>
          <div class="col-md-3">
            <label for="date" class="form-label">Date</label>
            <input type="date" class="form-control" id="date" name="date" value="<%= filters.date || '' %>">
          </div>
          <div class="col-md-2 d-grid gap-2">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-search"></i> Search
            </button>
            <button type="reset" class="btn btn-outline-secondary">
              <i class="fas fa-times"></i> Clear
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Trips List -->
<div class="row">
  <div class="col-12">
    <% if (trips && trips.length === 0) { %>
      <!-- No Trips State -->
      <div class="col-12">
        <div class="card shadow-sm border-0">
          <div class="card-body text-center py-5">
            <div class="emoji-xl text-muted mb-3">ðŸš—</div>
            <h3 class="text-muted">No Trips Found</h3>
            <p class="text-muted mb-3">Try adjusting your search or check back soon for new trips.</p>
            <div class="d-grid gap-2">
              <% if (user) { %>
                <a href="/trips/create" class="btn btn-primary">
                  <i class="fas fa-plus me-2"></i>Create Your Own Trip
                </a>
              <% } else { %>
                <a href="/auth/register" class="btn btn-primary">
                  <i class="fas fa-user-plus me-2"></i>Register to Share Rides
                </a>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    <% } else { %>
      <!-- Trips Grid -->
      <div class="row">
        <% trips.forEach((trip, index) => { %>
          <div class="col-lg-6 mb-4">
            <div class="card trip-card h-100 shadow-lg border-0">
              <div class="card-body p-4">
                <!-- Enhanced Route Header -->
                <div class="trip-header mb-3">
                  <div class="route-badges d-flex align-items-center justify-content-between">
                    <div class="trip-origin">
                      <span class="badge bg-gradient-primary text-white px-3 py-2 rounded-pill">
                        <i class="fas fa-map-marker-alt me-1"></i>
                        <%= trip.origin_text?.substring(0, 25) || 'Origin' %>
                      </span>
                    </div>
                    <div class="route-arrow text-muted">
                      <i class="fas fa-long-arrow-alt-right"></i>
                    </div>
                    <div class="trip-destination">
                      <span class="badge bg-gradient-danger text-white px-3 py-2 rounded-pill">
                        <i class="fas fa-flag-checkered me-1"></i>
                        <%= trip.destination_text?.substring(0, 25) || 'Destination' %>
                      </span>
                    </div>
                  </div>
                </div>

                <!-- Enhanced Date & Time -->
                <div class="trip-details mb-3">
                  <div class="row">
                    <div class="col-6">
                      <div class="detail-item">
                        <div class="icon-box bg-primary bg-opacity-10 rounded-circle p-2 me-2">
                          <i class="fas fa-calendar-alt text-primary"></i>
                        </div>
                        <div>
                          <div class="text-muted small">Departure Date</div>
                          <strong><%= new Date(trip.departure_timestamp).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %></strong>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="detail-item">
                        <div class="icon-box bg-info bg-opacity-10 rounded-circle p-2 me-2">
                          <i class="fas fa-clock text-info"></i>
                        </div>
                        <div>
                          <div class="text-muted small">Departure Time</div>
                          <strong><%= new Date(trip.departure_timestamp).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) %></strong>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Enhanced Driver Info -->
                <div class="driver-section mb-3">
                  <div class="d-flex align-items-center">
                    <div class="driver-avatar me-3">
                      <% if (trip.profiles?.avatar_url) { %>
                        <img src="<%= trip.profiles.avatar_url %>" alt="<%= trip.profiles.full_name %>" class="avatar-md rounded-circle border-2 border-light">
                      <% } else { %>
                        <div class="avatar-md placeholder-avatar rounded-circle">ðŸ‘¤</div>
                      <% } %>
                    </div>
                    <div class="driver-info flex-grow-1">
                      <div class="text-muted small">Driver</div>
                      <strong><%= trip.profiles?.full_name || 'Unknown Driver' %></strong>
                    </div>
                    <div class="driver-rating ms-auto">
                      <i class="fas fa-star text-warning"></i>
                      <i class="fas fa-star text-warning"></i>
                      <i class="fas fa-star text-warning"></i>
                      <i class="fas fa-star text-warning"></i>
                      <i class="fas fa-star-half-alt text-warning"></i>
                    </div>
                  </div>
                </div>

                <!-- Enhanced Seats & Price -->
                <div class="trip-pricing mb-3">
                  <div class="row align-items-center">
                    <div class="col-6">
                      <div class="seats-info">
                        <span class="badge bg-success text-white px-3 py-2 rounded-pill">
                          <i class="fas fa-users me-1"></i>
                          <%= trip.available_seats %> Seat<%= trip.available_seats !== 1 ? 's' : '' %>
                        </span>
                      </div>
                    </div>
                    <div class="col-6 text-end">
                      <% if (trip.price) { %>
                        <div class="price-info">
                          <div class="text-muted small">Price per seat</div>
                          <div class="price-amount text-success fw-bold">â‚¹<%= parseFloat(trip.price).toFixed(2) %></div>
                        </div>
                      <% } else { %>
                        <div class="price-info">
                          <div class="text-muted small">Price</div>
                          <div class="price-amount text-success fw-bold">Free</div>
                        </div>
                      <% } %>
                    </div>
                  </div>
                </div>

                <!-- Enhanced Action Button -->
                <div class="action-section">
                  <a href="/trips/<%= trip.id %>" class="btn btn-primary btn-lg w-100 rounded-pill fw-bold">
                    <i class="fas fa-eye me-2"></i>View Details & Book
                  </a>
                </div>
              </div>
            </div>
          </div>
        <% }); %>
      </div>
    <% } %>
  </div>
</div>