<div class="row">
  <div class="col-md-4">
    <h2>My Profile</h2>
    <% if (typeof error !== 'undefined' && error) { %>
      <div class="alert alert-danger"><%= error %></div>
    <% } %>
    <% if (typeof message !== 'undefined' && message) { %>
      <div class="alert alert-success"><%= message %></div>
    <% } %>
    <% if (typeof flash !== 'undefined' && flash.success) { %>
      <div class="alert alert-success"><%= flash.success %></div>
    <% } %>
    <% if (typeof flash !== 'undefined' && flash.error) { %>
      <div class="alert alert-danger"><%= flash.error %></div>
    <% } %>
    <% if (typeof query !== 'undefined' && query.success === 'password_changed') { %>
      <div class="alert alert-success">Password changed successfully!</div>
    <% } %>

    <div class="card">
      <img src="<%= profile.avatar_url || '/images/dummy-avatar.svg' %>" alt="<%= profile.full_name %>" class="card-img-top profile-hero" loading="lazy">
      <div class="card-body">
        <h5 class="card-title"><%= profile.full_name %></h5>
        <p class="card-text"><%= profile.bio || 'No bio provided' %></p>
      </div>
    </div>
  </div>

  <div class="col-md-8">
    <ul class="nav nav-tabs" id="profileTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="info-tab" data-bs-toggle="tab" data-bs-target="#info" type="button">Profile Info</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="password-tab" data-bs-toggle="tab" data-bs-target="#password" type="button">Change Password</button>
      </li>
    </ul>

    <div class="tab-content" id="profileTabContent">
      <!-- Profile Info Tab -->
      <div class="tab-pane fade show active" id="info" role="tabpanel">
        <div class="card mt-3">
          <div class="card-body">
            <h5 class="card-title">Update Profile</h5>
            <form action="/profile/update" method="POST" enctype="multipart/form-data">
              <div class="mb-3">
                <label for="full_name" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="full_name" name="full_name" value="<%= profile.full_name %>" required aria-describedby="fullNameError">
                <div id="fullNameError" class="invalid-feedback">Please enter your full name.</div>
              </div>

              <div class="mb-3">
                <label for="phone" class="form-label">Phone Number</label>
                <input type="tel" class="form-control" id="phone" name="phone" value="<%= profile.phone %>" required aria-describedby="phoneError">
                <div id="phoneError" class="invalid-feedback">Please enter a valid phone number.</div>
              </div>

              <div class="mb-3">
                <label for="bio" class="form-label">Bio</label>
                <textarea class="form-control" id="bio" name="bio" rows="3"><%= profile.bio || '' %></textarea>
              </div>

              <div class="mb-3">
                <label for="avatar" class="form-label">Profile Photo</label>
                <input type="file" class="form-control" id="avatar" name="avatar" accept="image/*" aria-describedby="avatarHelp">
                <input type="hidden" name="current_avatar_url" value="<%= profile.avatar_url || '' %>">
                <small id="avatarHelp" class="text-muted">Leave blank to keep current photo</small>
              </div>

              <button type="submit" class="btn btn-primary">Update Profile</button>
            </form>
          </div>
        </div>
      </div>

      <!-- Change Password Tab -->
      <div class="tab-pane fade" id="password" role="tabpanel">
        <div class="card mt-3">
          <div class="card-body">
            <h5 class="card-title">Change Password</h5>
            <form action="/profile/change-password" method="POST">
              <div class="mb-3">
                <label for="new_password" class="form-label">New Password</label>
                <input type="password" class="form-control" id="new_password" name="new_password" required aria-describedby="newPasswordError newPasswordHelp">
                <small id="newPasswordHelp" class="text-muted">Use at least 8 characters for a strong password.</small>
                <div id="newPasswordError" class="invalid-feedback">Please provide a stronger password.</div>
              </div>

              <div class="mb-3">
                <label for="confirm_password" class="form-label">Confirm Password</label>
                <input type="password" class="form-control" id="confirm_password" name="confirm_password" required aria-describedby="confirmPasswordError">
                <div id="confirmPasswordError" class="invalid-feedback">Passwords do not match.</div>
              </div>

              <button type="submit" class="btn btn-primary">Change Password</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>